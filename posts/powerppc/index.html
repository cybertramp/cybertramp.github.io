<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
    <title>PowerPC64 환경에서 CentOS7 - Inkblotty</title>

    <style type="text/css">
        img.wp-smiley,
        img.emoji {
            display: inline !important;
            border: none !important;
            box-shadow: none !important;
            height: 1em !important;
            width: 1em !important;
            margin: 0 .07em !important;
            vertical-align: -0.1em !important;
            background: none !important;
            padding: 0 !important;
        }
    </style>
    <link rel='stylesheet' href='https://cybertramp.net/css/style.css' type='text/css' media='all' />
    <link rel='stylesheet' href='https://cybertramp.net/css/custom.css' type='text/css' media='all' />
        
</head>
    <body class="two-column">
        <a href="#content">Skip to content</a>
<div class="wrapper">
    <header role="banner" class="banner widgets columns-1">
        <a href="/" rel="home">
            <h1 class="site">Inkblotty</h1>
            <p></p>
        </a>
        <nav role="navigation" aria-label="Primary Navigation">

            <ul class="menu">
                <li class="menu-item "><a class="menu__link" href="/about/">ABOUT</a></li>
            </ul>
            <select onChange="location.href=value;">
                <option value="/about/" class="menu-item menu-item-type-custom menu-item-object-custom" >ABOUT</option>
            </select>
        </nav>
    </header>

    <br>
    <div style="width: 100%; max-height: 100px; text-align: center;">
       
</div>

    <div class="breadcrumbs">
        
    </div>
        <div id="content" class="content">

<main role="main">
    <article role="article" class="post type-post format-standard hentry">
        <header class="post-header">
            <h1>PowerPC64 환경에서 CentOS7</h1>
            <div class="post-details">
                <a rel="bookmark">
                    <time datetime="2019-10-27T1027:125:06">2019-10-27</time>
                </a>
				
<span style="float: right;">
    <div id="fb-root" style="height: 100%;"></div>
    
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>
    
    <div class="fb-share-button" data-href="https://cybertramp.net/posts/powerppc/" data-layout="button_count" data-size="small">
        <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcybertramp.net%2fposts%2fpowerppc%2f" class="fb-xfbml-parse-ignore">Share</a>
    </div>
    &nbsp;
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="PowerPC64 환경에서 CentOS7" data-url="https://cybertramp.net/posts/powerppc/" data-show-count="false">Tweet</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    &nbsp;
    
</span>

            </div>
        </header>

        <div class="post-content">
            <p>Ubuntu 환경 위에서 qemu-system-ppc를 통해 CentOS 7을 실행한다.</p>
<blockquote>
<p>하루를 삽질했다&hellip;ㅠ</p>
</blockquote>
<h2 id="1-설치">1. 설치</h2>
<h3 id="1-centos7-minimal-다운로드">1) CentOS7 minimal 다운로드</h3>
<p>ppc 아키텍쳐 버전의 CentOS7은 다음 사이트에서 다운 받는다.</p>
<p><a href="http://isoredirect.centos.org/altarch/7/isos/ppc64/">http://isoredirect.centos.org/altarch/7/isos/ppc64/</a></p>
<p>원하는 미러 사이트에서 <code>CentOS-7-ppc64-Minimal-1908.iso</code>을 내려 받으면된다.</p>
<blockquote>
<p>나는 <a href="http://mirror.xtom.com.hk/centos-altarch/7.7.1908/isos/ppc64/">http://mirror.xtom.com.hk/centos-altarch/7.7.1908/isos/ppc64/</a> 이 미러에서 받았다.
가장 빨랐다.</p>
</blockquote>
<h3 id="2-qemu-설치">2) qemu 설치</h3>
<ul>
<li>
<p>qemu 설치</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install qemu-kvm qemu virt-manager virt-viewer libvirt-bin -y
</code></pre></div></li>
<li>
<p>ppc용 설치</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install qemu-system-ppc openbios-ppc -y
</code></pre></div></li>
</ul>
<h3 id="3-브릿지-설정">3) 브릿지 설정</h3>
<ul>
<li>
<p>설치</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install bridge-utils uml-utilities -y
</code></pre></div></li>
<li>
<p>브릿지 설정</p>
<p>브릿지 할 인터페이스는 <code>enp3s0</code>를 기준으로 함</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 브릿지 br0 인터페이스 생성</span>
sudo brctl addbr br0
  
<span style="color:#75715e"># enp3s0의 IP 클리어</span>
sudo ip addr flush dev enp3s0
  
<span style="color:#75715e"># br0를 enp3s0와 브릿지</span>
sudo brctl addif br0 enp3s0
  
<span style="color:#75715e"># tap 인터페이스 생성</span>
sudo tunctl -t tap0 -u <span style="color:#e6db74">`</span>whoami<span style="color:#e6db74">`</span>
  
<span style="color:#75715e"># br0를 tap0와 브릿지</span>
sudo brctl addif br0 tap0
</code></pre></div></li>
<li>
<p>인터페이스 활성화</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ifconfig enp3s0 up
ifconfig tap0 up
ifconfig br0 up
</code></pre></div></li>
<li>
<p>브릿지 확인 및 br0에 ip 할당</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brctl show <span style="color:#f92672">&amp;&amp;</span> sudo dhclient -v br0
</code></pre></div></li>
</ul>
<h3 id="4-가상-디스크-생성">4) 가상 디스크 생성</h3>
<p>가상 디스크를 생성한다. qcow2 방식의 20G로 생성한다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">qemu-img create -f qcow2 powerpc32.img 20G
</code></pre></div><h3 id="5-vnc-클라이언트-설치">5) VNC 클라이언트 설치</h3>
<p>윈도우의 경우 TigerVNC를 사용하고 우분투인 경우 아래와 같이 설치한다.</p>
<p>Remmina는 기본적으로 ssh, vnc, rdp를 지원하는 원격 접속 클라이언트이다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install remmina -y
</code></pre></div><h3 id="6-에뮬레이터-실행">6) 에뮬레이터 실행</h3>
<p>여러 가지 옵션으로 진행했기에 입맛에 맞춰 진행해야한다.</p>
<h4 id="진행">[진행]</h4>
<ul>
<li>
<p>가상 디스크에 OS 설치 전</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo qemu-system-ppc64 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-m <span style="color:#ae81ff">1024</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-boot d <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-hda powerpc32.img <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-netdev tap,id<span style="color:#f92672">=</span>mynet0,ifname<span style="color:#f92672">=</span>tap0,script<span style="color:#f92672">=</span>no,downscript<span style="color:#f92672">=</span>no -device 
-cdrom CentOS-7-ppc64-Minimal-1908.iso <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-vnc 0.0.0.0:5 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-usbdevice tablet
</code></pre></div></li>
<li>
<p>가상 디스크에 OS 설치 후</p>
<p>OS 설치가 완료됬기 때문에 CD를 빼는 것 처럼 두 개의 옵션을 제거 한다. <code>-boot</code>, <code>-cdrom</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo qemu-system-ppc64 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-m <span style="color:#ae81ff">1024</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-hda powerpc32.img <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>-netdev tap,id<span style="color:#f92672">=</span>mynet0,ifname<span style="color:#f92672">=</span>tap0,script<span style="color:#f92672">=</span>no,downscript<span style="color:#f92672">=</span>no -device e1000,netdev<span style="color:#f92672">=</span>mynet0,mac<span style="color:#f92672">=</span>52:54:00:fa:ce:11 <span style="color:#ae81ff">\ </span>
-vnc 0.0.0.0:5 <span style="color:#ae81ff">\ </span>
-usbdevice tablet
</code></pre></div></li>
</ul>
<h4 id="옵션">[옵션]</h4>
<p>옵션이 너무나도 많기에 옵션을 정리해둔다.</p>
<p><code>-m 1024</code>: 메모리 1024MB 할당, 최대 2047MB</p>
<p><code>-hda powerpc32.img</code>: 특정 가상 디스크 파일을 가상 드라이브로 설정</p>
<p><code>-boot d</code>: CD-ROM을 우선 부팅(<code>c</code> 인 경우 첫번째 가상 드라이브 우선 부팅)</p>
<p><code>-netdev tap,id=mynet0,ifname=tap0,script=no,downscript=no -device </code>: 가상 네트워크 케이블(TAP)를 통해 QEMU 게스트 OS와 연결, 호스트에서는 브릿지된 <code>tap0</code>가 먼저 설정되어야 함</p>
<p><code>-vnc 0.0.0.0:5</code>: 게스트 OS의 화면을 VNC로 중계, <code>0.0.0.0:5</code>은 모든 네트워크로 포트 5번을 의미. 만약 127.0.0.1이라면 QEMU를 실행중인 호스트OS만 접근이 가능</p>
<p><code>-usbdevice tablet</code>: 이중 커서 문제를 해결하기 위함, 이 옵션을 지정하지 않으면 VNC 연결시 호스트 OS 커서와 게스트 OS 커서 두 개가 생김</p>
<blockquote>
<p>참고</p>
<p>qemu 설치: <a href="https://www.unixmen.com/how-to-install-and-configure-qemu-in-ubuntu/">https://www.unixmen.com/how-to-install-and-configure-qemu-in-ubuntu/</a></p>
<p>네트워크 관련: <a href="https://gist.github.com/nstarke/c6593da117c459c18c255395211fa311">https://gist.github.com/nstarke/c6593da117c459c18c255395211fa311</a></p>
<p>네트워크 관련: <a href="https://www.linux-kvm.org/page/Networking">https://www.linux-kvm.org/page/Networking</a></p>
<p>ppc 구동 관련: <a href="https://gmplib.org/~tege/qemu.html">https://gmplib.org/~tege/qemu.html</a></p>
<p>virt-manager 관련: <a href="https://moriskim.wordpress.com/2014/02/24/virtio_with_kvm/">https://moriskim.wordpress.com/2014/02/24/virtio_with_kvm/</a></p>
<p>커널, initrd 관련: <a href="https://gist.github.com/nstarke/c6593da117c459c18c255395211fa311">https://gist.github.com/nstarke/c6593da117c459c18c255395211fa311</a></p>
<p>qemu 옵션들: <a href="https://wiki.gentoo.org/wiki/QEMU/Options#Boot_order">https://wiki.gentoo.org/wiki/QEMU/Options#Boot_order</a></p>
</blockquote>

        </div>

        <div>
        <div id="disqus_thread"></div>
        <script>

            



(function() { 
    var d = document, s = d.createElement('script');
    s.src = 'https://https-cybertramp-net.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        </div>

        <footer class="post-footer">
                
                
                
                <span class="post-categories">
                        <a href="https://cybertramp.net/categories/ppc64/">ppc64</a>&emsp;
                        
                </span>
                
        
                
                
                
        </footer>
        
<table cellspacing="15" style="width:100%; border: none;">
    <tr>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
    </tr>
</table>

        
    </article>

    

</main>


        <div class="sidebar1 widgets columns-1">

    <aside>
    
</aside>
    <aside class="widget widget_categories">
        <h2></h2>
        <ul class="widget__list"><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/daily/">daily (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/db/">DB (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/opencv/">opencv (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/ppc64/">ppc64 (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/ssd/">ssd (1)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/tip/">tip (2)</a>
            </li><li class="cat-item cat-item-2">
                <a href="https://cybertramp.net/categories/webserver/">webserver (1)</a>
            </li>
        </ul>
    </aside>

    <aside class="widget widget_tag_cloud">
        <h2></h2>
        <div class="tagcloud">
        </div>
    </aside>

    <aside class="widget widget_recent_entries">
        <h2></h2>
        <ul>
        </ul>
    </aside>

    <aside class="widget widget_archive">
        <h2></h2>
        <ul>
        </ul>
    </aside>

</div>
        </div>
        </div>
<footer role="contentinfo" class="document-footer contentinfo widgets columns-1">

    <aside class="widget widget_text">
        <div class="textwidget">
            <p>© Inkblotty / Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/tosi29/inkblotty" target="_blank">Inkblotty</a></p>
        </div>
    </aside>
</footer>
</div>

    </body>
</html>
